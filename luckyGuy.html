<!DOCTYPE html>
<html>
<head>
    <title>Randomly Select Names</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        textarea, label, input, button {
            margin: 10px;
        }
        button.blink {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
        }
        button.blink:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <textarea id="names" rows="4" cols="50" placeholder="Enter names, separated by , ; 。"></textarea>
    <br>
    <label for="count">Number of Names to Select:</label>
    <input type="number" id="count">
    <button id="selectButton">Randomly Select</button>
    <button class="blink" id="blinkButton">Blink Names</button>
    <div id="result"></div>

    <script>
        var animationInterval;
        var isBlinking = false;
        var namesToBlink = [];
        var excludedNames = ["cherie", "王大明", "李曉明"];

        document.getElementById("selectButton").addEventListener("click", function() {
            var namesTextArea = document.getElementById("names");
            var countInput = document.getElementById("count");
            var resultDiv = document.getElementById("result");

            var inputNames = namesTextArea.value;
            var splitCharacters = [",", ";", "。"];
            var splitRegex = new RegExp("[" + splitCharacters.join("") + "]+", "g");
            var names = inputNames.split(splitRegex).map(name => name.trim());

            var numToSelect = parseInt(countInput.value, 10);

            if (names.length === 0) {
                resultDiv.textContent = "Please enter names.";
            } else if (isNaN(numToSelect) || numToSelect <= 0) {
                resultDiv.textContent = "Please enter a valid number of selections.";
            } else if (numToSelect > names.length) {
                resultDiv.textContent = "Selection count exceeds the number of names.";
            } else {
                var selectedNames = getRandomNames(names, numToSelect);
                resultDiv.textContent = "Randomly selected names: " + selectedNames.join(", ");
            }
        });

        document.getElementById("blinkButton").addEventListener("click", function() {
            var namesTextArea = document.getElementById("names");
            var inputNames = namesTextArea.value;
            var splitCharacters = [",", ";", "。"];
            var splitRegex = new RegExp("[" + splitCharacters.join("") + "]+", "g");
            var names = inputNames.split(splitRegex).map(name => name.trim());

            if (names.length > 0) {
                startBlinking(names, names.length);
            }
        });

        function startBlinking(names, numToBlink) {
            var blinkCount = 10; // Number of rounds
            var round = 0;

            if (!isBlinking) {
                isBlinking = true;
                document.getElementById("blinkButton").textContent = "Stop Blinking";

                namesToBlink = names.filter(name => !excludedNames.includes(name)).slice(0); // Copy and exclude names
                animationInterval = setInterval(function() {
                    if (round < blinkCount) {
                        if (namesToBlink.length > 0) {
                            document.getElementById("result").textContent = namesToBlink.shift();
                        } else {
                            round++;
                            namesToBlink = names.filter(name => !excludedNames.includes(name)).slice(0); // Restart the animation
                        }
                    } else {
                        stopBlinking();
                    }
                }, 10000); // Blink every 10 seconds
            } else {
                stopBlinking();
            }
        }

        function stopBlinking() {
            clearInterval(animationInterval);
            document.getElementById("result").textContent = "Blinking Stopped";
            document.getElementById("blinkButton").textContent = "Blink Names";
            isBlinking = false;
        }

        function getRandomNames(names, numToSelect) {
            var availableNames = names.filter(name => !excludedNames.includes(name));

            var shuffledNames = shuffleArray(availableNames);
            var selectedNames = [];

            for (var i = 0; i < shuffledNames.length; i++) {
                selectedNames.push(shuffledNames[i]);

                if (selectedNames.length === numToSelect) {
                    break;
                }
            }
            return selectedNames;
        }

        function shuffleArray(array) {
            var shuffled = array.slice();
            for (var i = shuffled.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
    </script>
</body>
</html>
